# MantisDB Enhanced Build Configuration
version: "1.0.0"

build:
  platforms:
    - "linux/amd64"
    - "linux/arm64"
    - "darwin/amd64"
    - "darwin/arm64"
    - "windows/amd64"
  
  optimization:
    level: "size"  # size|speed|debug
    cgo_enabled: false
    build_flags:
      - "-trimpath"
    ldflags:
      - "-s"
      - "-w"
    tags: []
  
  frontend:
    build_command: "npm run build"
    output_dir: "admin/frontend/dist"
    embed_path: "admin/api/assets"
    node_version: "18"
    skip_build: false
  
  output:
    directory: "./dist"
    binary_prefix: "mantisdb"
    version_suffix: true
    clean_before: true
  
  parallel: true
  timeout: "30m"

packaging:
  compression:
    level: 9
    format: "auto"  # tar.gz for unix, zip for windows
  
  installers:
    unix:
      systemd: true
      homebrew: true
      user_local: true
    windows:
      chocolatey: true
      msi: false
      service: true
  
  assets:
    include_docs: true
    include_license: true
    extra_files:
      - "README.md"
      - "INSTALL.md"
    exclude_files:
      - "*.log"
      - "*.tmp"
  
  checksums:
    enabled: true
    algorithms:
      - "sha256"
    format: "standard"

distribution:
  github:
    repository: "mantisdb/mantisdb"
    token: ""  # Set via GITHUB_TOKEN environment variable
    draft: false
    prerelease: false
    release_notes: "auto"
    tag_prefix: "v"
  
  notifications:
    webhook_url: ""  # Set via NOTIFICATION_WEBHOOK_URL
    slack_channel: "#releases"
    email_to: ""
  
  security:
    code_signing:
      enabled: false
      macos_identity: ""  # Set via CODE_SIGNING_MACOS_IDENTITY
      windows_cert: ""    # Set via CODE_SIGNING_WINDOWS_CERT
      windows_pass: ""    # Set via CODE_SIGNING_WINDOWS_PASS
    verification:
      dependency_check: true
      reproducible_build: true
      audit_log: true

environment:
  required_tools:
    - "go"
    - "node"
    - "npm"
    - "gh"
  
  env_vars: {}
  
  paths:
    work_dir: "."
    temp_dir: "/tmp/mantisdb-build"
    cache_dir: "./.build-cache"
    output_dir: "./dist"
  
  resources:
    max_memory: "4GB"
    max_cpu: 0  # Use all available
    disk_space: "10GB"
    build_timeout: "60m"